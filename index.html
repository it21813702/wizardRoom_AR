<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Crystal on Marker</title>

    <!-- Load A-Frame and AR.js -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <a-scene
      embedded
      arjs="sourceType: webcam;"
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true;"
    >

      <!-- Lighting -->
      <a-entity light="type: ambient; intensity: 0.8"></a-entity>
      <a-entity light="type: directional; intensity: 1" position="1 2 2"></a-entity>

      <!-- Assets -->
      <a-assets>
        <a-asset-item
          id="crystalsModel"
          src="models2/crystals-three.glb"
          onerror="console.error('âŒ crystals.glb failed to load')"
        ></a-asset-item>
        <audio id="cBgSound" src="sounds/crystal-bg.mp3"></audio>
      </a-assets>

      <!-- Marker -->
      <a-marker
        type="pattern"
        url="markers/pattern-cryst.patt"
        emitevents="true"
        id="marker"
      >
        <a-entity
          gltf-model="#crystalsModel"
          position="0 0 0"
          scale="5 5 5"
          animation="property: rotation; to: 0 360 0; loop: true; dur: 10000"
        ></a-entity>
      </a-marker>

      <!-- Background sound (outside marker) -->
      <a-entity 
        id="bgPlayer" 
        sound="src: #cBgSound; loop: true; volume: 0.5"
      ></a-entity>

      <!-- Camera -->
      <a-entity camera></a-entity>
    </a-scene>

    <!-- JS: Console Logs + Sound Trigger -->
    <script>
      console.log("ðŸ“¦ Scene Loaded");
    
      const scene = document.querySelector("a-scene");
      const marker = document.querySelector("#marker");
      const bgSound = document.querySelector("#bgPlayer");
    
      if (scene.hasLoaded) {
        console.log("âœ… A-Frame Scene Ready");
      } else {
        scene.addEventListener("loaded", () => {
          console.log("âœ… A-Frame Scene Loaded (event)");
        });
      }
    
      marker.addEventListener("markerFound", () => {
        console.log("ðŸŽ¯ Marker FOUND");
    
        // Play the background sound when marker appears
        bgSound.components.sound.playSound();
      });
    
      marker.addEventListener("markerLost", () => {
        console.log("ðŸ“­ Marker LOST");
    
        // Stop the background sound when marker disappears
        bgSound.components.sound.stopSound();
      });
    </script>
    
  </body>
</html>
